# Drone Localization Algorithms

This project implements and evaluates sound-based drone localization algorithms (DAS, Functional Beamforming, MUSIC, and Capon) using the Acoular library. It processes audio recordings to estimate drone positions, applies affine transformations to align results with ground truth trajectories, and visualizes error distributions. The project is implemented in Python and includes scripts for beamforming, trajectory alignment, and cumulative error distribution (CED) plotting.

## Prerequisites

- **Python**: 3.12.4
- **Libraries**:
  - Acoular 25.3.post1
  - NumPy 2.1.3
  - SciPy 1.15.2
  - Matplotlib 3.10.1
- **Tools**:
  - FFmpeg 7.1.1 (for video output)
  - MATLAB Ground Truth Labeler 24.2.0.2863752 (for ground truth data, if used)
  - Audacity 2.4.2 (optional, for audio preprocessing)
- **Hardware**: Tested on Intel® Core™ i5-12450H
- **Input Files**:
  - Audio recordings: `./signal_audio/wall1.wav`, `./signal_audio/wall2.wav`, `./signal_audio/wall3.wav`
  - Microphone geometry: `./setup/microphones_set.xml`
  - Ground truth trajectories: `./points_lab/avg/wall{1,2,3}_traj.npy`

## Directory Structure

- **`./signal_audio/`**: Contains input audio files (`wall1.wav`, `wall2.wav`, `wall3.wav`) for drone localization.
- **`./setup/`**: Stores the microphone array configuration file (`microphones_set.xml`).
- **`./points_lab/avg/`**: Contains ground truth trajectory files (`wall{1,2,3}_traj.npy`) for each recording.
- **`./points_bf/`**: Stores raw and focused localization points generated by `beamformer.py` (e.g., `wall1_BeamformerBase_points.npy`, `wall1_BeamformerBase_focuspoints.npy`).
- **`./results/maps/`**: Stores video outputs of localization maps (e.g., `wall1_BeamformerBase_map.mp4`).
- **`./results/affine/`**: Contains affine transformation matrices computed by `ransac_affine.py` (e.g., `wall1_affine_matrix.npy`).
- **`./results/dist/`**: Stores error distances between estimated and ground truth trajectories (e.g., `wall1_BeamformerBase_dist_focuspoints.npy`) and a log file (`dist.log`) with error statistics.
- **`./results/plots/ransac/traj/`**: Contains SVG plots of aligned trajectories (e.g., `wall1_BeamformerBase_traj.svg`).
- **`./results/plots/ced/`**: Contains SVG plots of cumulative error distributions (e.g., `BeamformerBase_ced.svg`, `wall1_ced_all.svg`).

## Scripts and Execution Order

The project consists of three main scripts that must be executed sequentially. Below is the execution order, purpose of each script, generated outputs, and their locations.

### 1. `beamformer.py`
**Purpose**: Processes audio recordings using specified beamforming algorithms (DAS, Functional Beamforming, MUSIC, Capon) to estimate drone positions and generate visualization maps.

**Execution**:
```bash
python beamformer.py
```
- The script iterates over all recordings (`wall1.wav`, `wall2.wav`, `wall3.wav`) and algorithms (`BeamformerBase`, `BeamformerFunctional`, `BeamformerMusic`, `BeamformerCapon`).
- Requires FFmpeg installed for video output.

**Outputs**:
- **Localization points**:
  - Raw points: `./points_bf/{recording}_{algorithm}_points.npy` (e.g., `wall1_BeamformerBase_points.npy`)
  - Focused points: `./points_bf/{recording}_{algorithm}_focuspoints.npy` (e.g., `wall1_BeamformerBase_focuspoints.npy`)
- **Visualization maps**:
  - Videos: `./results/maps/{recording}_{algorithm}_map.mp4` (e.g., `wall1_BeamformerBase_map.mp4`)

**Notes**:
- The script uses a rectangular grid (2x2 meters, z=1m) with 0.1m increments for localization.
- Frame rate is set to 30 FPS, and the sample frequency is 96 kHz.

### 2. `ransac_affine.py`
**Purpose**: Aligns estimated drone positions (focus points) with ground truth trajectories using RANSAC-based affine transformations, applies filters (range and outlier), and computes error distances.

**Execution**:
```bash
python ransac_affine.py
```
- Iterates over all recordings and algorithms, using outputs from `beamformer.py` and ground truth trajectories from `./points_lab/avg/`.

**Outputs**:
- **Affine transformation matrices**:
  - `./results/affine/{recording}_affine_matrix.npy` (e.g., `wall1_affine_matrix.npy`)
- **Error distances**:
  - `./results/dist/{recording}_{algorithm}_dist_focuspoints.npy` (e.g., `wall1_BeamformerBase_dist_focuspoints.npy`)
  - Error statistics log: `./results/dist/dist.log` (contains average, median, standard deviation, and RMSE for each recording-algorithm pair)
- **Trajectory plots**:
  - SVG files: `./results/plots/ransac/traj/{recording}_{algorithm}_traj.svg` (e.g., `wall1_BeamformerBase_traj.svg`)
- **Error distribution plots**:
  - Generated internally but closed after creation (not saved unless modified).

**Notes**:
- Applies range filter (clips points outside [654, 1254] for x and [0, 1920] for y) and outlier filter (removes points with differences >30 pixels).
- Errors are computed using the L∞ norm.

### 3. `ced.py`
**Purpose**: Generates cumulative error distribution (CED) plots for each algorithm across all recordings and for all algorithms per recording.

**Execution**:
```bash
python ced.py
```
- Uses error distances from `ransac_affine.py`.

**Outputs**:
- **CED plots per algorithm**:
  - SVG files: `./results/plots/ced/{algorithm}_ced.svg` (e.g., `BeamformerBase_ced.svg`), showing CED for each recording.
- **CED plots per recording**:
  - SVG files: `./results/plots/ced/{recording}_ced_all.svg` (e.g., `wall1_ced_all.svg`), comparing all algorithms for a single recording.

**Notes**:
- Plots use a 100-bin histogram with a range of 0–100 pixels.
- Y-axis is formatted as percentages.

## Usage Example

1. Ensure all prerequisites are installed and input files are in place.
2. Run the scripts in order:
   ```bash
   python beamformer.py
   python ransac_affine.py
   python ced.py
   ```
3. Check outputs in the respective directories:
   - Videos in `./results/maps/` for localization visualizations.
   - Trajectory plots in `./results/plots/ransac/traj/` for aligned trajectories.
   - Error distributions in `./results/plots/ced/` for performance comparisons.
   - Error statistics in `./results/dist/dist.log` for numerical results.